    function createAddAppModal() {
            // Remove any existing modal
            document.querySelectorAll('.add-app-modal').forEach(m => m.remove());

            // Modal overlay
            const overlay = document.createElement('div');
            overlay.className = 'add-app-modal';
            overlay.style.position = 'fixed';
            overlay.style.left = 0;
            overlay.style.top = 0;
            overlay.style.width = '100vw';
            overlay.style.height = '100vh';
            overlay.style.background = 'rgba(0,0,0,0.7)';
            overlay.style.zIndex = 10000;
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';

            // Modal box
            const modal = document.createElement('div');
            modal.style.background = '#222';
            modal.style.color = '#fff';
            modal.style.borderRadius = '12px';
            modal.style.padding = '32px 28px 20px 28px';
            modal.style.boxShadow = '0 4px 24px rgba(0,0,0,0.5)';
            modal.style.minWidth = '320px';
            modal.style.maxWidth = '90vw';
            modal.style.fontFamily = 'Poppins, sans-serif';
            modal.style.position = 'relative';

            // Close button
            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'Ã—';
            closeBtn.style.position = 'absolute';
            closeBtn.style.top = '10px';
            closeBtn.style.right = '16px';
            closeBtn.style.background = 'none';
            closeBtn.style.border = 'none';
            closeBtn.style.color = '#fff';
            closeBtn.style.fontSize = '28px';
            closeBtn.style.cursor = 'pointer';
            closeBtn.addEventListener('click', () => overlay.remove());
            modal.appendChild(closeBtn);

            // Title
            const title = document.createElement('h2');
            title.textContent = 'Add App';
            title.style.margin = '0 0 18px 0';
            title.style.fontWeight = '600';
            title.style.fontSize = '22px';
            modal.appendChild(title);

            // "Form" (now a div)
            const form = document.createElement('div');
            form.style.display = 'flex';
            form.style.flexDirection = 'column';
            form.style.gap = '14px';

            // App Name
            const nameLabel = document.createElement('label');
            nameLabel.textContent = 'App Name';
            nameLabel.style.fontWeight = '400';
            nameLabel.style.fontSize = '15px';
            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.required = true;
            nameInput.style.padding = '8px 10px';
            nameInput.style.borderRadius = '6px';
            nameInput.style.border = '1px solid #444';
            nameInput.style.background = '#181818';
            nameInput.style.color = '#fff';
            nameInput.style.fontSize = '15px';
            nameInput.autocomplete = 'off';
            nameLabel.appendChild(nameInput);

            // App Link
            const linkLabel = document.createElement('label');
            linkLabel.textContent = 'App Link (URL)';
            linkLabel.style.fontWeight = '400';
            linkLabel.style.fontSize = '15px';
            const linkInput = document.createElement('input');
            linkInput.type = 'url';
            linkInput.required = true;
            linkInput.style.padding = '8px 10px';
            linkInput.style.borderRadius = '6px';
            linkInput.style.border = '1px solid #444';
            linkInput.style.background = '#181818';
            linkInput.style.color = '#fff';
            linkInput.style.fontSize = '15px';
            linkInput.placeholder = 'https://';
            linkInput.autocomplete = 'off';
            linkLabel.appendChild(linkInput);

            // App Image
            const imgLabel = document.createElement('label');
            imgLabel.textContent = 'App Icon (URL or File)';
            imgLabel.style.fontWeight = '400';
            imgLabel.style.fontSize = '15px';
            const imgInputUrl = document.createElement('input');
            imgInputUrl.type = 'url';
            imgInputUrl.style.padding = '8px 10px';
            imgInputUrl.style.borderRadius = '6px';
            imgInputUrl.style.border = '1px solid #444';
            imgInputUrl.style.background = '#181818';
            imgInputUrl.style.color = '#fff';
            imgInputUrl.style.fontSize = '15px';
            imgInputUrl.placeholder = 'https://example.com/icon.png';
            imgInputUrl.autocomplete = 'off';
            imgInputUrl.style.marginBottom = '6px';

            const imgInputFile = document.createElement('input');
            imgInputFile.type = 'file';
            imgInputFile.accept = 'image/*';
            imgInputFile.style.color = '#fff';
            imgInputFile.style.fontSize = '15px';

            // Preview
            const preview = document.createElement('img');
            preview.style.display = 'block';
            preview.style.margin = '10px auto 0 auto';
            preview.style.maxWidth = '60px';
            preview.style.maxHeight = '60px';
            preview.style.borderRadius = '8px';
            preview.style.background = '#333';
            preview.style.objectFit = 'contain';
            preview.style.boxShadow = '0 1px 4px rgba(0,0,0,0.2)';
            preview.style.opacity = '0.85';

            // Preview logic
            function updatePreview() {
            if (imgInputFile.files && imgInputFile.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                preview.src = e.target.result;
                preview.style.display = 'block';
                };
                reader.readAsDataURL(imgInputFile.files[0]);
            } else if (imgInputUrl.value) {
                preview.src = imgInputUrl.value;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
            }
            imgInputUrl.addEventListener('input', updatePreview);
            imgInputFile.addEventListener('change', updatePreview);

            imgLabel.appendChild(imgInputUrl);
            imgLabel.appendChild(imgInputFile);
            imgLabel.appendChild(preview);

            // Done button
            const doneBtn = document.createElement('button');
            doneBtn.type = 'button';
            doneBtn.textContent = 'Done';
            doneBtn.className = 'btn';

            // Error message
            const errMsg = document.createElement('div');
            errMsg.style.color = '#ff6b6b';
            errMsg.style.fontSize = '13px';
            errMsg.style.marginTop = '2px';
            errMsg.style.display = 'none';

            form.appendChild(nameLabel);
            form.appendChild(linkLabel);
            form.appendChild(imgLabel);
            form.appendChild(errMsg);
            form.appendChild(doneBtn);

            // "Form" submit logic
            doneBtn.addEventListener('click', function(e) {
            errMsg.style.display = 'none';

            const name = nameInput.value.trim();
            const link = linkInput.value.trim();
            let imgSrc = imgInputUrl.value.trim();

            if (!name) {
                errMsg.textContent = 'Please enter an app name.';
                errMsg.style.display = 'block';
                return;
            }
            if (!link) {
                errMsg.textContent = 'Please enter an app link.';
                errMsg.style.display = 'block';
                return;
            }

            // If file is selected, use it
            if (imgInputFile.files && imgInputFile.files[0]) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                imgSrc = ev.target.result;
                addApp(name, link, imgSrc);
                overlay.remove();
                };
                reader.readAsDataURL(imgInputFile.files[0]);
                return;
            }

            // If no image at all
            if (!imgSrc) {
                errMsg.textContent = 'Please provide an app icon (URL or file).';
                errMsg.style.display = 'block';
                return;
            }

            addApp(name, link, imgSrc);
            overlay.remove();
            });

            modal.appendChild(form);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // Focus first input
            setTimeout(() => nameInput.focus(), 100);
        }

        function addApp(name, link, imgSrc, appid) {
            // Find last .apps-list (with at least one) or first
            let lists = Array.from(document.querySelectorAll('.apps-list'));
            let list = lists.find(l => l.children.length > 0) || lists[0];

            // Create app-item
            const li = document.createElement('li');
            li.className = 'app-item';
            li.dataset.appid = appid || ('user_' + Date.now() + '_' + Math.floor(Math.random() * 10000));

            // Icon
            const iconDiv = document.createElement('div');
            iconDiv.className = 'icon';
            const img = document.createElement('img');
            img.src = imgSrc;
            img.alt = name + ' Icon';
            img.width = 52;
            img.height = 52;
            iconDiv.appendChild(img);

            // Link
            const a = document.createElement('a');
            a.href = link;
            a.className = 'app-link';
            a.textContent = name;

            li.appendChild(iconDiv);
            li.appendChild(a);

            // Add to end of list
            list.appendChild(li);

            // Make draggable
            enableDragAndDropForList(list);

            // Clickable
            li.addEventListener('click', function(e) {
            if (e.target.tagName === 'A') return;
            window.open(link, '_blank', 'noopener');
            });

            // Open links in new tab
            a.addEventListener('click', function(e) {
            e.preventDefault();
            window.open(this.href, '_blank', 'noopener');
            });

            // Save to localStorage
            saveCustomAppsToStorage();
        }

        // Add App button handler
        document.getElementById('addApp').addEventListener('click', createAddAppModal);

        // Save custom apps to localStorage
        function saveCustomAppsToStorage() {
            const customApps = [];
            document.querySelectorAll('.app-item[data-appid^="user_"]').forEach(li => {
            const a = li.querySelector('a');
            const img = li.querySelector('img');
            customApps.push({
                appid: li.dataset.appid,
                name: a ? a.textContent : '',
                link: a ? a.href : '',
                imgSrc: img ? img.src : ''
            });
            });
            localStorage.setItem('customApps', JSON.stringify(customApps));
        }

        // Load custom apps from localStorage
        function loadCustomAppsFromStorage() {
            const customApps = JSON.parse(localStorage.getItem('customApps') || '[]');
            const hidden = JSON.parse(localStorage.getItem('hiddenApps') || '{}');
            customApps.forEach(app => {
            // Prevent duplicates
            if (!document.querySelector(`.app-item[data-appid="${app.appid}"]`)) {
                addApp(app.name, app.link, app.imgSrc, app.appid);
            }
            // Hide if in hiddenApps
            const el = document.querySelector(`.app-item[data-appid="${app.appid}"]`);
            if (el && hidden[app.appid]) {
                el.style.display = 'none';
            }
            });
        }

        // On page load, restore custom apps and then restore app order
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomAppsFromStorage();
            // Wait for custom apps to be added, then restore order
            setTimeout(function() {
            if (typeof loadAllAppOrders === 'function') loadAllAppOrders();
            }, 0);
        });

        // Modal CSS
        (function() {
            if (document.getElementById('add-app-modal-style')) return;
            const style = document.createElement('style');
            style.id = 'add-app-modal-style';
            style.textContent = `
            .add-app-modal input[type="text"], .add-app-modal input[type="url"] {
            outline: none;
            transition: border 0.2s;
            }
            .add-app-modal input[type="text"]:focus, .add-app-modal input[type="url"]:focus {
            border: 1.5px solid #6a0dad;
            }
            .add-app-modal input[type="file"]::-webkit-file-upload-button {
            background: #4b0082;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            }
            .add-app-modal input[type="file"]::file-selector-button {
            background: #4b0082;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            }
            .add-app-modal input[type="file"] {
            background: #181818;
            border: none;
            margin-top: 2px;
            }
            `;
            document.head.appendChild(style);
        })();
